<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .breadcrumb {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .coming-soon {
            text-align: center;
            padding: 3rem 1rem;
            color: #666;
        }
        
        .coming-soon .icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #667eea;
        }
        
        .coming-soon h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .coming-soon p {
            font-size: 1.1rem;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .features-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .features-list h4 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .features-list ul {
            list-style: none;
            padding: 0;
        }
        
        .features-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
            color: #666;
        }
        
        .features-list li:last-child {
            border-bottom: none;
        }
        
        .features-list li:before {
            content: "üöÄ ";
            margin-right: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }
        
        .form-group textarea,
        .form-group input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .form-group textarea:focus,
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group small {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: block;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .html-help {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .html-help h4 {
            color: #1976d2;
            margin-bottom: 0.5rem;
        }
        
        .html-help code {
            background: #f5f5f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .media-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .media-preview img,
        .media-preview video {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        
        .file-id-preview {
            background: #f8f9fa;
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            margin-top: 0.5rem;
        }
        
        .file-id-preview i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .file-id-preview p {
            margin: 0.5rem 0;
            font-family: monospace;
            word-break: break-all;
            color: #495057;
        }
        
        .file-id-preview small {
            color: #6c757d;
        }
        
        .add-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
        }
        
        .mailings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .mailing-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .mailing-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .mailing-card h3 {
            color: #495057;
            margin-bottom: 0.5rem;
        }
        
        .mailing-card p {
            color: #6c757d;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .mailing-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .start-btn:hover {
            transform: translateY(-1px);
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .delete-btn:hover {
            transform: translateY(-1px);
        }
        
        .status-active {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-scheduled {
            color: #007bff;
            font-weight: bold;
        }
        
        .status-inactive {
            color: #6c757d;
            font-weight: bold;
        }
        
        .cancel-schedule-btn {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 8px;
        }
        
        .cancel-schedule-btn:hover {
            transform: translateY(-1px);
        }
        
        .resend-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 8px;
        }
        
        .resend-btn:hover {
            transform: translateY(-1px);
        }
        
        .make-recurring-btn {
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 8px;
        }
        
        .make-recurring-btn:hover {
            transform: translateY(-1px);
        }
        
        .toggle-recurring-btn {
            background: linear-gradient(135deg, #fd7e14 0%, #e55a00 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 8px;
        }
        
        .toggle-recurring-btn:hover {
            transform: translateY(-1px);
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 1rem;
        }
        
        .tab-btn {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1.5rem;
            border-radius: 8px 8px 0 0;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: none;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .tab-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .tab-btn:not(.active) .tab-count {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –∫–∞—Ä—Ç–æ–∫ */
        .sent-card {
            border-left: 4px solid #28a745;
        }
        
        .scheduled-card {
            border-left: 4px solid #007bff;
        }
        
        .recurring-card {
            border-left: 4px solid #ffc107;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –¥—ñ–π */
        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó */
        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }
        
        .search-filter input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .search-filter input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-filter select {
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
            min-width: 150px;
        }
        
        .search-filter select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group select[multiple] {
            min-height: 120px;
        }
        
        .status-filter {
            color: #007bff;
            font-weight: 500;
        }
        

        
        .media-url {
            color: #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .media-file-id {
            color: #28a745;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .buttons-section {
            margin-bottom: 1.5rem;
        }
        
        .buttons-section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }
        
        .button-row input {
            padding: 0.5rem;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .remove-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .add-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .send-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
        }
        
        .schedule-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-left: 8px;
        }
        
        .schedule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .tab-btn {
                border-radius: 8px;
                text-align: center;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .mailing-actions {
                flex-direction: column;
            }
            
            .mailing-actions button {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .mailings-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–∞—Ç—É—Å—ñ–≤ */
        .status-active {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-scheduled {
            color: #007bff;
            font-weight: bold;
        }
        
        .status-inactive {
            color: #6c757d;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Ä—Ç–æ–∫ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ */
        .sent-card {
            border-left: 4px solid #28a745;
        }
        
        .scheduled-card {
            border-left: 4px solid #007bff;
        }
        
        .recurring-card {
            border-left: 4px solid #ffc107;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó */
        .mailing-card small {
            color: #6c757d;
            font-size: 0.85em;
        }
        
        .mailing-card .status-active {
            color: #28a745;
        }
        
        .mailing-card .status-scheduled {
            color: #007bff;
        }
        
        .mailing-card .status-inactive {
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏</h1>
        <div class="nav-buttons">
            <a href="{{ url_for('admin_panel') }}" class="nav-btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="{{ url_for('logout') }}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="container">
        <div class="breadcrumb">
            <a href="{{ url_for('admin_panel') }}">üè† –ì–ª–∞–≤–Ω–∞—è</a> ‚Üí üì¢ –†–∞—Å—Å—ã–ª–∫–∞
        </div>
        
        <div class="card">
            <h2>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É</h2>
            <form method="POST" action="{{ url_for('create_mailing_route') }}" id="mailingForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="mailing_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏:</label>
                    <input type="text" id="mailing_name" name="mailing_name" 
                           placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏" required>
                </div>
                
                <div class="form-group">
                    <label for="message_text">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:</label>
                    <textarea id="message_text" name="message_text" 
                              placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏..." required></textarea>
                    <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML —Ä–∞–∑–º–µ—Ç–∫–∞</small>
                </div>
                
                <div class="html-help">
                    <h4>üí° HTML —Ç–µ–≥–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
                    <p><code>&lt;b&gt;–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç&lt;/b&gt;</code> - <b>–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</b></p>
                    <p><code>&lt;i&gt;–∫—É—Ä—Å–∏–≤&lt;/i&gt;</code> - <i>–∫—É—Ä—Å–∏–≤</i></p>
                    <p><code>&lt;u&gt;–ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π&lt;/u&gt;</code> - <u>–ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π</u></p>
                    <p><code>&lt;s&gt;–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π&lt;/s&gt;</code> - <s>–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π</s></p>
                    <p><code>&lt;code&gt;–∫–æ–¥&lt;/code&gt;</code> - <code>–∫–æ–¥</code></p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="media_type">–¢–∏–ø –º–µ–¥–∏–∞:</label>
                        <select id="media_type" name="media_type" onchange="toggleMediaFields()">
                            <option value="none">–ë–µ–∑ –º–µ–¥–∏–∞</option>
                            <option value="photo">–§–æ—Ç–æ</option>
                            <option value="video">–í–∏–¥–µ–æ</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="media_url_group" style="display: none;">
                        <label for="media_url">URL –º–µ–¥–∏–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ File ID:</label>
                        <input type="text" id="media_url" name="media_url" 
                               placeholder="https://example.com/image.jpg –∏–ª–∏ BAACAgIAAxkDAAI..." oninput="updateMediaPreview()">
                        <div class="help-text">
                            <strong>–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong><br>
                            ‚Ä¢ <strong>URL:</strong> https://example.com/image.jpg<br>
                            ‚Ä¢ <strong>File ID:</strong> BAACAgIAAxkDAAI... (–ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–¥–∏–∞ –≤ Telegram)
                        </div>
                    </div>
                </div>
                
                <div id="media_preview" class="media-preview" style="display: none;">
                    <strong>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:</strong>
                    <div id="preview_content"></div>
                </div>
                
                <div class="buttons-section">
                    <h3>üì± Inline –∫–Ω–æ–ø–∫–∏</h3>
                    <div id="buttons-container">
                        <div class="button-row">
                            <input type="text" name="button_text[]" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏">
                            <input type="url" name="button_link[]" placeholder="–°—Å—ã–ª–∫–∞">
                            <button type="button" class="remove-button" onclick="removeButton(this)" style="display: none;">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <button type="button" class="add-button" onclick="addButton()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É</button>
                </div>
                
                <div class="schedule-section">
                    <h3>‚è∞ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="schedule_type">–¢–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏:</label>
                            <select id="schedule_type" name="schedule_type" onchange="toggleScheduleFields()">
                                <option value="immediate">–°—Ä–∞–∑—É</option>
                                <option value="scheduled">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="schedule_datetime_group" style="display: none;">
                            <label for="schedule_datetime">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è (–ö–∏–µ–≤):</label>
                            <input type="datetime-local" id="schedule_datetime" name="schedule_datetime">
                            <small>–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ –∫–∏–µ–≤—Å–∫–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="user_filter">–§–∏–ª—å—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</label>
                        <select id="user_filter" name="user_filter" onchange="toggleUserFilterFields()">
                            <option value="all">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                            <option value="status">–ü–æ —Å—Ç–∞—Ç—É—Å—É</option>
                        </select>
                        <small>–í—ã–±–µ—Ä–∏—Ç–µ, –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</small>
                    </div>
                    
                    <div class="form-group" id="status_filter_group" style="display: none;">
                        <label for="user_status">–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</label>
                        <select id="user_status" name="user_status" multiple>
                            <option value="–ù–∞–∂–∞–ª —Å—Ç–∞—Ä—Ç">1  –ù–∞–∂–∞–ª —Å—Ç–∞—Ä—Ç</option>
                            <option value="–ü—Ä–æ—à–µ–ª –∫–∞–ø—á—É">2 –ü—Ä–æ—à–µ–ª –∫–∞–ø—á—É</option>
                            <option value="–ü–æ—Å–º–æ—Ç—Ä–µ–ª –æ—Ç–≤–µ—Ç—ã">3 –ü–æ—Å–º–æ—Ç—Ä–µ–ª –æ—Ç–≤–µ—Ç—ã</option>
                            <option value="–ü–æ—Å–º–æ—Ç—Ä–µ–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —É—Ä–æ–∫">4 –ü–æ—Å–º–æ—Ç—Ä–µ–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —É—Ä–æ–∫</option>
                            <option value="–ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã">5 –ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã</option>
                            <option value="–ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã –æ–¥–µ–∂–¥–∞">6 –ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã –æ–¥–µ–∂–¥–∞</option>
                            <option value="–ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã —Ç–µ—Ö–Ω–∏–∫–∞">7 –ü–æ—Å–º–æ—Ç—Ä–µ–ª —Ç–∞—Ä–∏—Ñ—ã —Ç–µ—Ö–Ω–∏–∫–∞</option>
                            <option value="–ù–∞–∂–∞–ª –æ–ø–ª–∞—Ç–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫–∞">8 –ù–∞–∂–∞–ª –æ–ø–ª–∞—Ç–∏—Ç—å —Ç–µ—Ö–Ω–∏–∫–∞</option>
                            <option value="–ù–∞–∂–∞–ª –æ–ø–ª–∞—Ç–∏—Ç—å –æ–¥–µ–∂–¥–∞">9 –ù–∞–∂–∞–ª –æ–ø–ª–∞—Ç–∏—Ç—å –æ–¥–µ–∂–¥–∞</option>
                            <option value="–û–ø–ª–∞—Ç–∏–ª –æ–¥–µ–∂–¥—É">10 –û–ø–ª–∞—Ç–∏–ª –æ–¥–µ–∂–¥—É</option>
                            <option value="–û–ø–ª–∞—Ç–∏–ª —Ç–µ—Ö–Ω–∏–∫—É">11 –û–ø–ª–∞—Ç–∏–ª —Ç–µ—Ö–Ω–∏–∫—É</option>
                        </select>
                        <small>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–æ–≤ (Ctrl+Click –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞)</small>
                    </div>
                    
                    <div class="form-group" id="recurring_section" style="display: none;">
                        <label>
                            <input type="checkbox" id="is_recurring" name="is_recurring" onchange="toggleRecurringFields()">
                            üîÑ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è
                        </label>
                        
                        <div id="recurring_fields" style="display: none; margin-top: 1rem;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="recurring_days">–î–Ω–∏ –Ω–µ–¥–µ–ª–∏:</label>
                                    <select id="recurring_days" name="recurring_days" multiple>
                                        <option value="0">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                                        <option value="1">–í—Ç–æ—Ä–Ω–∏–∫</option>
                                        <option value="2">–°—Ä–µ–¥–∞</option>
                                        <option value="3">–ß–µ—Ç–≤–µ—Ä–≥</option>
                                        <option value="4">–ü—è—Ç–Ω–∏—Ü–∞</option>
                                        <option value="5">–°—É–±–±–æ—Ç–∞</option>
                                        <option value="6">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
                                    </select>
                                    <small>–í—ã–±–µ—Ä–∏—Ç–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="recurring_time">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ö–∏–µ–≤):</label>
                                    <input type="time" id="recurring_time" name="recurring_time" value="09:00">
                                    <small>–í—Ä–µ–º—è –ø–æ –∫–∏–µ–≤—Å–∫–æ–º—É —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="add-btn">üìù –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
                    <button type="button" class="send-btn" onclick="createAndSendMailing()">üì¢ –°–æ–∑–¥–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button type="button" class="schedule-btn" onclick="createAndScheduleMailing()" style="display: none;">üìÖ –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </form>
        </div>
        
        <div class="card">
            <h2>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏</h2>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–∞—Å—Å—ã–ª–æ–∫ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('all')">
                    üìã –í—Å–µ —Ä–∞—Å—Å—ã–ª–∫–∏ 
                    <span class="tab-count">({{ mailings|length }})</span>
                </button>
                <button class="tab-btn" onclick="showTab('sent')">
                    ‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ 
                    <span class="tab-count" id="sent-count">(0)</span>
                </button>
                <button class="tab-btn" onclick="showTab('scheduled')">
                    üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 
                    <span class="tab-count" id="scheduled-count">(0)</span>
                </button>
                <button class="tab-btn" onclick="showTab('recurring')">
                    üîÑ –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è 
                    <span class="tab-count" id="recurring-count">(0)</span>
                </button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ "–í—Å–µ —Ä–∞—Å—Å—ã–ª–∫–∏" -->
            <div id="tab-all" class="tab-content active">
                <!-- DEBUG: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å—Å—ã–ª–æ–∫: {{ mailings|length }} -->
                {% if mailings %}
                    <div class="mailings-grid">
                        {% for mailing in mailings %}
                            <!-- DEBUG: –†–∞—Å—Å—ã–ª–∫–∞ {{ loop.index }}: ID={{ mailing.id }}, is_active={{ mailing.is_active }}, is_scheduled={{ mailing.is_scheduled }}, is_recurring={{ mailing.is_recurring }}, scheduled_at={{ mailing.scheduled_at }}, next_scheduled_at={{ mailing.next_scheduled_at }} -->
                            <div class="mailing-card">
                                <h3>{{ mailing.name }}</h3>
                                <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ mailing.message_text[:50] }}{% if mailing.message_text|length > 50 %}...{% endif %}</p>
                                <p><strong>–ú–µ–¥–∏–∞:</strong> {{ mailing.media_type }} 
                                {% if mailing.media_url %}
                                    {% if mailing.media_url.startswith(('http://', 'https://')) %}
                                        - <span class="media-url">URL: {{ mailing.media_url[:30] }}...</span>
                                    {% else %}
                                        - <span class="media-file-id">File ID: {{ mailing.media_url[:20] }}...</span>
                                    {% endif %}
                                {% endif %}
                                </p>
                                <p><strong>–ö–Ω–æ–ø–∫–∏:</strong> {{ mailing.inline_buttons if mailing.inline_buttons else '–ë–µ–∑ –∫–Ω–æ–ø–æ–∫' }}</p>
                                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                                    {% if mailing.is_active %}
                                        <span class="status-active">‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</span>
                                    {% elif mailing.scheduled_at and mailing.is_scheduled %}
                                        <span class="status-scheduled">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ {{ mailing.scheduled_at[:16] }}</span>
                                        {% if mailing.scheduled_at %}
                                            <br><small>üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞: {{ mailing.scheduled_at[:16] }} (–ö–∏–µ–≤)</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="status-inactive">üìù –°–æ–∑–¥–∞–Ω–∞</span>
                                    {% endif %}
                                </p>
                                
                                {% if mailing.is_recurring %}
                                <p><strong>üîÑ –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è:</strong> 
                                    <span class="status-active">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞</span>
                                    <!-- DEBUG: recurring_days = {{ mailing.recurring_days }} -->
                                    {% if mailing.recurring_days %}
                                        <br><small>üìÖ –î–Ω–∏ –Ω–µ–¥–µ–ª–∏: 
                                            {% set days_map = {0: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', 1: '–í—Ç–æ—Ä–Ω–∏–∫', 2: '–°—Ä–µ–¥–∞', 3: '–ß–µ—Ç–≤–µ—Ä–≥', 4: '–ü—è—Ç–Ω–∏—Ü–∞', 5: '–°—É–±–±–æ—Ç–∞', 6: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'} %}
                                            <!-- DEBUG: –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É "{{ mailing.recurring_days }}" –Ω–∞ –¥–Ω–∏ -->
                                            {% for day in mailing.recurring_days.split(',') %}
                                                <!-- DEBUG: –î–µ–Ω—å {{ loop.index }}: "{{ day }}" -> {{ days_map[day|int] }} -->
                                                {{ days_map[day|int] }}{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                        </small>
                                    {% endif %}
                                    {% if mailing.recurring_time %}
                                        <br><small>‚è∞ –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: {{ mailing.recurring_time }} (–ö–∏–µ–≤)</small>
                                    {% endif %}
                                </p>
                                {% endif %}
                                
                                <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ mailing.created_at }}</p>
                                <p><strong>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong> 
                                    {% if mailing.sent_at %}
                                        {{ mailing.sent_at }} ({{ mailing.users_count }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
                                    {% else %}
                                        –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å
                                    {% endif %}
                                </p>
                                <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> {{ mailing.users_count if mailing.users_count else '0' }}</p>
                                
                                {% if mailing.user_filter and mailing.user_filter != 'all' %}
                                <p><strong>–§–∏–ª—å—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> 
                                    {% if mailing.user_filter == 'status' %}
                                        <span class="status-filter">–ü–æ —Å—Ç–∞—Ç—É—Å—É: {{ mailing.user_status if mailing.user_status else '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
                                    {% endif %}
                                </p>
                                {% endif %}
                                
                                <div class="mailing-actions">
                                    {% if not mailing.is_active and not mailing.is_scheduled %}
                                        <button class="start-btn" data-id="{{ mailing.id }}">
                                            üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                        </button>
                                    {% endif %}
                                    
                                    {% if mailing.is_scheduled and not mailing.is_active %}
                                        <button class="cancel-schedule-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                            ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                                        </button>
                                    {% endif %}
                                    
                                    {% if mailing.is_active %}
                                        <button class="resend-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                            üîÑ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–æ–≤–∞
                                        </button>
                                    {% endif %}
                                    
                                    {% if mailing.is_active and not mailing.is_recurring %}
                                        <button class="make-recurring-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                            üîÑ –°–¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è
                                        </button>
                                    {% endif %}
                                    
                                    {% if mailing.is_recurring %}
                                        <button class="toggle-recurring-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}" data-active="true">
                                            üîÑ –í—ã–∫–ª—é—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
                                        </button>
                                    {% endif %}

                                    <a href="{{ url_for('edit_mailing', mailing_id=mailing.id) }}" class="edit-btn" style="
                                        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                                        color: white;
                                        border: none;
                                        padding: 0.5rem 1rem;
                                        border-radius: 6px;
                                        font-size: 0.9rem;
                                        text-decoration: none;
                                        display: inline-block;
                                        transition: transform 0.2s ease;
                                        margin-right: 8px;
                                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>

                                    <button class="delete-btn" 
                                            data-id="{{ mailing.id }}"
                                            data-name="{{ mailing.name|e }}">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <h3>üì≠ –†–∞—Å—Å—ã–ª–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3> 
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏" -->
            <div id="tab-sent" class="tab-content">
                {% set sent_mailings = [] %}
                {% for mailing in mailings %}
                    {% if mailing.is_active %}
                        {% set _ = sent_mailings.append(mailing) %}
                    {% endif %}
                {% endfor %}
                
                <!-- DEBUG: –ù–∞–π–¥–µ–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫: {{ sent_mailings|length }} -->
                {% if sent_mailings %}
                    <div class="mailings-grid">
                        {% for mailing in sent_mailings %}
                            <div class="mailing-card sent-card">
                                <h3>{{ mailing.name }}</h3>
                                <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ mailing.message_text[:50] }}{% if mailing.message_text|length > 50 %}...{% endif %}</p>
                                <p><strong>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong> {{ mailing.sent_at }} ({{ mailing.users_count }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)</p>
                                <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ mailing.created_at }}</p>
                                
                                <div class="mailing-actions">
                                    <button class="resend-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                        üîÑ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–æ–≤–∞
                                    </button>
                                    
                                    {% if not mailing.is_recurring %}
                                        <button class="make-recurring-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                            üîÑ –°–¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è
                                        </button>
                                    {% endif %}
                                    
                                    <a href="{{ url_for('edit_mailing', mailing_id=mailing.id) }}" class="edit-btn" style="
                                        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                                        color: white;
                                        border: none;
                                        padding: 0.5rem 1rem;
                                        border-radius: 6px;
                                        font-size: 0.9rem;
                                        text-decoration: none;
                                        display: inline-block;
                                        transition: transform 0.2s ease;
                                        margin-right: 8px;
                                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    
                                    <button class="delete-btn" 
                                            data-id="{{ mailing.id }}"
                                            data-name="{{ mailing.name|e }}">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <h3>üì≠ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3> 
                        <p>–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–∞—Å—Å—ã–ª–∫—É</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏" -->
            <div id="tab-scheduled" class="tab-content">
                {% set scheduled_mailings = [] %}
                {% for mailing in mailings %}
                    {% if mailing.is_scheduled %}
                        {% set _ = scheduled_mailings.append(mailing) %}
                    {% endif %}
                {% endfor %}
                
                <!-- DEBUG: –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫: {{ scheduled_mailings|length }} -->
                {% if scheduled_mailings %}
                    <div class="mailings-grid">
                        {% for mailing in scheduled_mailings %}
                            <!-- DEBUG: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ {{ loop.index }}: ID={{ mailing.id }}, is_recurring={{ mailing.is_recurring }}, recurring_days={{ mailing.recurring_days }}, recurring_time={{ mailing.recurring_time }}, next_scheduled_at={{ mailing.next_scheduled_at }} -->
                            <div class="mailing-card scheduled-card">
                                <h3>{{ mailing.name }}</h3>
                                <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ mailing.message_text[:50] }}{% if mailing.message_text|length > 50 %}...{% endif %}</p>
                                <p><strong>üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:</strong> {{ mailing.scheduled_at[:16] if mailing.scheduled_at else 'N/A' }} (–ö–∏–µ–≤)</p>
                                {% if mailing.is_recurring %}
                                <p><strong>üîÑ –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è:</strong> 
                                    <span class="status-active">‚úÖ –î–∞</span>
                                    <!-- DEBUG: recurring_days = {{ mailing.recurring_days }} -->
                                    {% if mailing.recurring_days %}
                                        <br><small>üìÖ –î–Ω–∏ –Ω–µ–¥–µ–ª–∏: 
                                            {% set days_map = {0: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', 1: '–í—Ç–æ—Ä–Ω–∏–∫', 2: '–°—Ä–µ–¥–∞', 3: '–ß–µ—Ç–≤–µ—Ä–≥', 4: '–ü—è—Ç–Ω–∏—Ü–∞', 5: '–°—É–±–±–æ—Ç–∞', 6: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'} %}
                                            <!-- DEBUG: –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É "{{ mailing.recurring_days }}" –Ω–∞ –¥–Ω–∏ -->
                                            {% for day in mailing.recurring_days.split(',') %}
                                                <!-- DEBUG: –î–µ–Ω—å {{ loop.index }}: "{{ day }}" -> {{ days_map[day|int] }} -->
                                                {{ days_map[day|int] }}{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                        </small>
                                    {% endif %}
                                    {% if mailing.recurring_time %}
                                        <br><small>‚è∞ –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: {{ mailing.recurring_time }} (–ö–∏–µ–≤)</small>
                                    {% endif %}

                                </p>
                                {% endif %}
                                <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ mailing.created_at }}</p>
                                
                                <div class="mailing-actions">
                                    <a href="{{ url_for('edit_mailing', mailing_id=mailing.id) }}" class="edit-btn" style="
                                        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                                        color: white;
                                        border: none;
                                        padding: 0.5rem 1rem;
                                        border-radius: 6px;
                                        font-size: 0.9rem;
                                        text-decoration: none;
                                        display: inline-block;
                                        transition: transform 0.2s ease;
                                        margin-right: 8px;
                                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    
                                    <button class="start-btn" data-id="{{ mailing.id }}">
                                        üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å
                                    </button>
                                    
                                    <button class="cancel-schedule-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                                    </button>
                                    
                                    <button class="delete-btn" 
                                            data-id="{{ mailing.id }}"
                                            data-name="{{ mailing.name|e }}">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <h3>üì≠ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3> 
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫—É —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å —Ç—É—Ç</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ä–∞—Å—Å—ã–ª–∫–∏" -->
            <div id="tab-recurring" class="tab-content">
                {% set recurring_mailings = [] %}
                {% for mailing in mailings %}
                    {% if mailing.is_recurring %}
                        {% set _ = recurring_mailings.append(mailing) %}
                    {% endif %}
                {% endfor %}
                
                <!-- DEBUG: –ù–∞–π–¥–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—Å—ã–ª–æ–∫: {{ recurring_mailings|length }} -->
                {% if recurring_mailings %}
                    <div class="mailings-grid">
                        {% for mailing in recurring_mailings %}
                            <div class="mailing-card recurring-card">
                                <h3>{{ mailing.name }}</h3>
                                <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ mailing.message_text[:50] }}{% if mailing.message_text|length > 50 %}...{% endif %}</p>
                                <p><strong>üîÑ –ì—Ä–∞—Ñ–∏–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:</strong> 
                                    <!-- DEBUG: recurring_days = {{ mailing.recurring_days }} -->
                                    {% if mailing.recurring_days %}
                                        <br><small>üìÖ –î–Ω–∏ –Ω–µ–¥–µ–ª–∏: 
                                            {% set days_map = {0: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', 1: '–í—Ç–æ—Ä–Ω–∏–∫', 2: '–°—Ä–µ–¥–∞', 3: '–ß–µ—Ç–≤–µ—Ä–≥', 4: '–ü—è—Ç–Ω–∏—Ü–∞', 5: '–°—É–±–±–æ—Ç–∞', 6: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'} %}
                                            <!-- DEBUG: –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É "{{ mailing.recurring_days }}" –Ω–∞ –¥–Ω–∏ -->
                                            {% for day in mailing.recurring_days.split(',') %}
                                                <!-- DEBUG: –î–µ–Ω—å {{ loop.index }}: "{{ day }}" -> {{ days_map[day|int] }} -->
                                                {{ days_map[day|int] }}{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                        </small>
                                    {% endif %}
                                    {% if mailing.recurring_time %}
                                        <br><small>‚è∞ –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: {{ mailing.recurring_time }} (–ö–∏–µ–≤)</small>
                                    {% endif %}
                                </p>
                                <p><strong>üîÑ –°–ª–µ–¥—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:</strong> 
                                    {% if mailing.next_scheduled_at %}
                                        {{ mailing.next_scheduled_at[:16] }} (–ö–∏–µ–≤)
                                    {% else %}
                                        <span class="status-inactive">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</span>
                                    {% endif %}
                                </p>
                                <p><strong>üì§ –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—Ç–ø—Ä–∞–≤–∫–∞:</strong> 
                                    {% if mailing.sent_at %}
                                        {{ mailing.sent_at[:16] }} ({{ mailing.users_count }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
                                    {% else %}
                                        <span class="status-inactive">–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å</span>
                                    {% endif %}
                                </p>
                                <p><strong>üìÖ –°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> 
                                    {% if mailing.is_scheduled %}
                                        <span class="status-scheduled">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</span>
                                        {% if mailing.scheduled_at %}
                                            <br><small>–Ω–∞ {{ mailing.scheduled_at[:16] }} (–ö–∏–µ–≤)</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="status-inactive">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</span>
                                    {% endif %}
                                </p>
                                <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ mailing.created_at }}</p>
                                
                                <div class="mailing-actions">
                                    <a href="{{ url_for('edit_mailing', mailing_id=mailing.id) }}" class="edit-btn" style="
                                        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                                        color: white;
                                        border: none;
                                        padding: 0.5rem 1rem;
                                        border-radius: 6px;
                                        font-size: 0.9rem;
                                        text-decoration: none;
                                        display: inline-block;
                                        transition: transform 0.2s ease;
                                        margin-right: 8px;
                                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </a>
                                    
                                    <button class="resend-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}">
                                        üîÑ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–æ–≤–∞
                                    </button>
                                    
                                    <button class="toggle-recurring-btn" data-id="{{ mailing.id }}" data-name="{{ mailing.name|e }}" data-active="true">
                                        üîÑ –í—ã–∫–ª—é—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
                                    </button>
                                    
                                    <button class="delete-btn" 
                                            data-id="{{ mailing.id }}"
                                            data-name="{{ mailing.name|e }}">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 3rem; color: #6c757d;">
                        <h3>üì≠ –ü–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—Å—ã–ª–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3> 
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫—É —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å —Ç—É—Ç</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card">
            <h2>‚ÑπÔ∏è –û —Ä–∞—Å—Å—ã–ª–∫–µ</h2>
            <p>–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±–æ—Ç–∞, –æ—Ç–ø—Ä–∞–≤–ª—è—è –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ–≤–æ—Å—Ç–∏, –∞–∫—Ü–∏–∏ –∏ –¥—Ä—É–≥–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
            <p><strong>–í–∞–∂–Ω–æ:</strong> –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–æ—Ç–∞.</p>
        </div>
    </div>
    
    <script>
        function toggleMediaFields() {
            const mediaType = document.getElementById('media_type').value;
            const mediaUrlGroup = document.getElementById('media_url_group');
            const mediaPreview = document.getElementById('media_preview');
            
            if (mediaType === 'none') {
                mediaUrlGroup.style.display = 'none';
                mediaPreview.style.display = 'none';
            } else {
                mediaUrlGroup.style.display = 'block';
                updateMediaPreview();
            }
        }
        
        function updateMediaPreview() {
            const mediaType = document.getElementById('media_type').value;
            const mediaUrl = document.getElementById('media_url').value;
            const mediaPreview = document.getElementById('media_preview');
            const previewContent = document.getElementById('preview_content');
            
            if (mediaType !== 'none' && mediaUrl) {
                mediaPreview.style.display = 'block';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ URL –∏–ª–∏ File ID
                const isUrl = mediaUrl.startsWith('http://') || mediaUrl.startsWith('https://');
                
                if (mediaType === 'photo') {
                    if (isUrl) {
                        previewContent.innerHTML = `
                            <img src="${mediaUrl}" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ" onerror="this.style.display='none'">
                        `;
                    } else {
                        previewContent.innerHTML = `
                            <div class="file-id-preview">
                                <i class="üì∑"></i>
                                <p><strong>File ID:</strong> ${mediaUrl}</p>
                                <small>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è File ID</small>
                            </div>
                        `;
                    }
                } else if (mediaType === 'video') {
                    if (isUrl) {
                        previewContent.innerHTML = `
                            <video controls>
                                <source src="${mediaUrl}" type="video/mp4">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                            </video>
                        `;
                    } else {
                        previewContent.innerHTML = `
                            <div class="file-id-preview">
                                <i class="üé•"></i>
                                <p><strong>File ID:</strong> ${mediaUrl}</p>
                                <small>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è File ID</small>
                            </div>
                        `;
                    }
                }
            } else {
                mediaPreview.style.display = 'none';
            }
        }
        
        function startMailing(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç—É —Ä–∞—Å—Å—ã–ª–∫—É? –û–Ω–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞.')) {
                window.location.href = `/start_mailing/${id}`;
            }
        }
        
        function deleteMailing(id, mailingName) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É "${mailingName}"?`)) {
                window.location.href = `/delete_mailing/${id}`;
            }
        }
        
        function cancelScheduledMailing(id, mailingName) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏ "${mailingName}"?`)) {
                window.location.href = `/cancel_scheduled_mailing/${id}`;
            }
        }
        

        
        function addButton() {
            const container = document.getElementById('buttons-container');
            const buttonRow = document.createElement('div');
            buttonRow.className = 'button-row';
            
            buttonRow.innerHTML = `
                <input type="text" name="button_text[]" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏">
                <input type="url" name="button_link[]" placeholder="–°—Å—ã–ª–∫–∞">
                <button type="button" class="remove-button" onclick="removeButton(this)">–£–¥–∞–ª–∏—Ç—å</button>
            `;
            
            container.appendChild(buttonRow);
            
            console.log('üîç DEBUG: –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞');
            console.log('   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:', container);
            console.log('   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:', container.querySelectorAll('input[name="button_text[]"]').length);
        }
        
        function removeButton(button) {
            const container = document.getElementById('buttons-container');
            button.parentElement.remove();
            
            console.log('üîç DEBUG: –£–¥–∞–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞');
            console.log('   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:', container.querySelectorAll('input[name="button_text[]"]').length);
        }
        
        function createAndSendMailing() {
            console.log('üîç DEBUG: createAndSendMailing –≤–∏–∫–ª–∏–∫–∞–Ω–æ');
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ —Ñ–æ—Ä–º–∏
            const formData = new FormData();
            formData.append('mailing_name', document.getElementById('mailing_name').value);
            formData.append('message_text', document.getElementById('message_text').value);
            formData.append('media_type', document.getElementById('media_type').value);
            formData.append('media_url', document.getElementById('media_url').value || '');
            
            // –ó–±–∏—Ä–∞—î–º–æ –∫–Ω–æ–ø–∫–∏
            const buttonTexts = document.querySelectorAll('input[name="button_text[]"]');
            const buttonLinks = document.querySelectorAll('input[name="button_link[]"]');
            const buttons = [];
            
            console.log('üîç DEBUG: –ó–±–∏—Ä–∞—î–º–æ –∫–Ω–æ–ø–∫–∏ –∑ —Ñ–æ—Ä–º–∏:');
            console.log('   buttonTexts:', buttonTexts);
            console.log('   buttonLinks:', buttonLinks);
            console.log('   –ö—ñ–ª—å–∫—ñ—Å—Ç—å:', buttonTexts.length);
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω–µ –ø–æ–ª–µ –æ–∫—Ä–µ–º–æ
            buttonTexts.forEach((input, index) => {
                console.log(`   –ü–æ–ª–µ button_text[${index}]:`, input);
                console.log(`   –ó–Ω–∞—á–µ–Ω–Ω—è button_text[${index}]:`, input.value);
            });
            
            buttonLinks.forEach((input, index) => {
                console.log(`   –ü–æ–ª–µ button_link[${index}]:`, input);
                console.log(`   –ó–Ω–∞—á–µ–Ω–Ω—è button_link[${index}]:`, input.value);
            });
            
            for (let i = 0; i < buttonTexts.length; i++) {
                const text = buttonTexts[i].value.trim();
                const link = buttonLinks[i].value.trim();
                
                console.log(`   –ö–Ω–æ–ø–∫–∞ ${i+1}: text='${text}', link='${link}'`);
                
                if (text && link) {
                    buttons.push({
                        text: text,
                        url: link
                    });
                    console.log(`   ‚úÖ –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É: ${text} -> ${link}`);
                } else {
                    console.log(`   ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ –∫–Ω–æ–ø–∫—É (–ø–æ—Ä–æ–∂–Ω—è): text='${text}', link='${link}'`);
                }
            }
            
            const buttonsJson = JSON.stringify(buttons);
            console.log('üîç DEBUG: –°—Ç–≤–æ—Ä–µ–Ω–æ JSON –∫–Ω–æ–ø–æ–∫:', buttonsJson);
            console.log('üîç DEBUG: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:', buttons.length);
            
            // –î–æ–¥–∞—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –≤ FormData
            formData.append('inline_buttons', buttonsJson);
            formData.append('send_immediately', 'true');
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            const userFilter = document.getElementById('user_filter').value;
            formData.append('user_filter', userFilter);
            
            if (userFilter === 'status') {
                const userStatus = document.getElementById('user_status');
                const selectedStatuses = [];
                for (let i = 0; i < userStatus.options.length; i++) {
                    if (userStatus.options[i].selected) {
                        selectedStatuses.push(userStatus.options[i].value);
                    }
                }
                formData.append('user_status', selectedStatuses.join(','));
                console.log('üîç DEBUG: –§—ñ–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:', selectedStatuses);
            }
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è
            const isRecurring = document.getElementById('is_recurring').checked;
            if (isRecurring) {
                formData.append('is_recurring', 'on');
                
                const recurringDays = document.getElementById('recurring_days');
                const recurringTime = document.getElementById('recurring_time').value;
                
                console.log('üîç DEBUG: –ï–ª–µ–º–µ–Ω—Ç recurring_days:', recurringDays);
                console.log('üîç DEBUG: –í—Å—ñ –æ–ø—Ü—ñ—ó:', recurringDays.options);
                console.log('üîç DEBUG: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ–ø—Ü—ñ–π:', recurringDays.options.length);
                
                // –ó–±–∏—Ä–∞—î–º–æ –≤–∏–±—Ä–∞–Ω—ñ –¥–Ω—ñ
                const selectedDays = [];
                for (let i = 0; i < recurringDays.options.length; i++) {
                    const option = recurringDays.options[i];
                    console.log(`üîç DEBUG: –û–ø—Ü—ñ—è ${i}: value="${option.value}", text="${option.text}", selected=${option.selected}`);
                    if (option.selected) {
                        selectedDays.push(option.value);
                        console.log(`‚úÖ –î–æ–¥–∞–Ω–æ –≤–∏–±—Ä–∞–Ω–∏–π –¥–µ–Ω—å: ${option.value} (${option.text})`);
                    }
                }
                
                console.log('üîç DEBUG: –í—Å—ñ –≤–∏–±—Ä–∞–Ω—ñ –¥–Ω—ñ:', selectedDays);
                console.log('üîç DEBUG: –†—è–¥–æ–∫ –¥–Ω—ñ–≤ –¥–ª—è FormData:', selectedDays.join(','));
                
                formData.append('recurring_days', selectedDays.join(','));
                formData.append('recurring_time', recurringTime);
                
                console.log('üîç DEBUG: –î–æ–¥–∞–Ω–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è:');
                console.log('   is_recurring:', isRecurring);
                console.log('   recurring_days:', selectedDays.join(','));
                console.log('   recurring_time:', recurringTime);
            }
            
            // –õ–æ–≥—É—î–º–æ –≤–µ—Å—å FormData
            console.log('üîç DEBUG: –í—Å—ñ –¥–∞–Ω—ñ FormData:');
            for (let [key, value] of formData.entries()) {
                console.log(`   ${key}: ${value}`);
            }
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Ä–æ–∑—Å–∏–ª–∫—É
            console.log('üîç DEBUG: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ create_and_send_mailing_route');
            fetch('{{ url_for("create_and_send_mailing_route") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–†–æ–∑—Å–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Ç–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
                    location.reload();
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + error);
            });
        }
        
        function toggleScheduleFields() {
            const scheduleType = document.getElementById('schedule_type').value;
            const scheduleDatetimeGroup = document.getElementById('schedule_datetime_group');
            const scheduleBtn = document.querySelector('.schedule-btn');
            const recurringSection = document.getElementById('recurring_section');
            
            if (scheduleType === 'immediate') {
                scheduleDatetimeGroup.style.display = 'none';
                scheduleBtn.style.display = 'none';
                recurringSection.style.display = 'none';
            } else if (scheduleType === 'scheduled') {
                scheduleDatetimeGroup.style.display = 'block';
                scheduleBtn.style.display = 'inline-block';
                recurringSection.style.display = 'block';
                setCurrentKyivTime();
            }
        }
        
        function setCurrentKyivTime() {
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å –ö–∏—î–≤–∞
            const now = new Date();
            
            // –§–æ—Ä–º–∞—Ç—É—î–º–æ –¥–ª—è datetime-local (–ª–æ–∫–∞–ª—å–Ω–∏–π —á–∞—Å –±—Ä–∞—É–∑–µ—Ä–∞)
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            const datetimeString = `${year}-${month}-${day}T${hours}:${minutes}`;
            document.getElementById('schedule_datetime').value = datetimeString;
        }
        
        function createAndScheduleMailing() {
            console.log('üîç DEBUG: createAndScheduleMailing –≤–∏–∫–ª–∏–∫–∞–Ω–æ');
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ —Ñ–æ—Ä–º–∏
            const formData = new FormData();
            formData.append('mailing_name', document.getElementById('mailing_name').value);
            formData.append('message_text', document.getElementById('message_text').value);
            formData.append('media_type', document.getElementById('media_type').value);
            formData.append('media_url', document.getElementById('media_url').value || '');
            
            // –ó–±–∏—Ä–∞—î–º–æ –∫–Ω–æ–ø–∫–∏
            const buttonTexts = document.querySelectorAll('input[name="button_text[]"]');
            const buttonLinks = document.querySelectorAll('input[name="button_link[]"]');
            const buttons = [];
            
            console.log('üîç DEBUG: createAndScheduleMailing - –∑–±–∏—Ä–∞—î–º–æ –∫–Ω–æ–ø–∫–∏:');
            console.log('   buttonTexts:', buttonTexts);
            console.log('   buttonLinks:', buttonLinks);
            console.log('   –ö—ñ–ª—å–∫—ñ—Å—Ç—å:', buttonTexts.length);
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω–µ –ø–æ–ª–µ –æ–∫—Ä–µ–º–æ
            buttonTexts.forEach((input, index) => {
                console.log(`   –ü–æ–ª–µ button_text[${index}]:`, input);
                console.log(`   –ó–Ω–∞—á–µ–Ω–Ω—è button_text[${index}]:`, input.value);
            });
            
            buttonLinks.forEach((input, index) => {
                console.log(`   –ü–æ–ª–µ button_link[${index}]:`, input);
                console.log(`   –ó–Ω–∞—á–µ–Ω–Ω—è button_link[${index}]:`, input.value);
            });
            
            for (let i = 0; i < buttonTexts.length; i++) {
                const text = buttonTexts[i].value.trim();
                const link = buttonLinks[i].value.trim();
                
                console.log(`   –ö–Ω–æ–ø–∫–∞ ${i+1}: text='${text}', link='${link}'`);
                
                if (text && link) {
                    buttons.push({
                        text: text,
                        url: link
                    });
                    console.log(`   ‚úÖ –î–æ–¥–∞–Ω–æ –∫–Ω–æ–ø–∫—É: ${text} -> ${link}`);
                } else {
                    console.log(`   ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ –∫–Ω–æ–ø–∫—É (–ø–æ—Ä–æ–∂–Ω—è): text='${text}', link='${link}'`);
                }
            }
            
            const buttonsJson = JSON.stringify(buttons);
            console.log('üîç DEBUG: –°—Ç–≤–æ—Ä–µ–Ω–æ JSON –∫–Ω–æ–ø–æ–∫:', buttonsJson);
            console.log('üîç DEBUG: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:', buttons.length);
            
            // –î–æ–¥–∞—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –≤ FormData
            formData.append('inline_buttons', buttonsJson);
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            const userFilter = document.getElementById('user_filter').value;
            formData.append('user_filter', userFilter);
            
            if (userFilter === 'status') {
                const userStatus = document.getElementById('user_status');
                const selectedStatuses = [];
                for (let i = 0; i < userStatus.options.length; i++) {
                    if (userStatus.options[i].selected) {
                        selectedStatuses.push(userStatus.options[i].value);
                    }
                }
                formData.append('user_status', selectedStatuses.join(','));
                console.log('üîç DEBUG: –§—ñ–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:', selectedStatuses);
            }
            
            // –õ–æ–≥—É—î–º–æ –≤–µ—Å—å FormData
            console.log('üîç DEBUG: –í—Å—ñ –¥–∞–Ω—ñ FormData –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:');
            for (let [key, value] of formData.entries()) {
                console.log(`   ${key}: ${value}`);
            }
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è
            const scheduleType = document.getElementById('schedule_type').value;
            const scheduleDatetime = document.getElementById('schedule_datetime').value;
            
            formData.append('schedule_type', scheduleType);
            formData.append('schedule_datetime', scheduleDatetime);
            
            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è
            const isRecurring = document.getElementById('is_recurring').checked;
            if (isRecurring) {
                formData.append('is_recurring', 'on');
                
                const recurringDays = document.getElementById('recurring_days');
                const recurringTime = document.getElementById('recurring_time').value;
                
                console.log('üîç DEBUG: –ï–ª–µ–º–µ–Ω—Ç recurring_days:', recurringDays);
                console.log('üîç DEBUG: –í—Å—ñ –æ–ø—Ü—ñ—ó:', recurringDays.options);
                console.log('üîç DEBUG: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ–ø—Ü—ñ–π:', recurringDays.options.length);
                
                // –ó–±–∏—Ä–∞—î–º–æ –≤–∏–±—Ä–∞–Ω—ñ –¥–Ω—ñ
                const selectedDays = [];
                for (let i = 0; i < recurringDays.options.length; i++) {
                    const option = recurringDays.options[i];
                    console.log(`üîç DEBUG: –û–ø—Ü—ñ—è ${i}: value="${option.value}", text="${option.text}", selected=${option.selected}`);
                    if (option.selected) {
                        selectedDays.push(option.value);
                        console.log(`‚úÖ –î–æ–¥–∞–Ω–æ –≤–∏–±—Ä–∞–Ω–∏–π –¥–µ–Ω—å: ${option.value} (${option.text})`);
                    }
                }
                
                console.log('üîç DEBUG: –í—Å—ñ –≤–∏–±—Ä–∞–Ω—ñ –¥–Ω—ñ:', selectedDays);
                console.log('üîç DEBUG: –†—è–¥–æ–∫ –¥–Ω—ñ–≤ –¥–ª—è FormData:', selectedDays.join(','));
                
                formData.append('recurring_days', selectedDays.join(','));
                formData.append('recurring_time', recurringTime);
                
                console.log('üîç DEBUG: –î–æ–¥–∞–Ω–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è:');
                console.log('   is_recurring:', isRecurring);
                console.log('   recurring_days:', selectedDays.join(','));
                console.log('   recurring_time:', recurringTime);
            }
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è
            console.log('üîç DEBUG: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ create_and_schedule_mailing_route');
            fetch('{{ url_for("create_and_schedule_mailing_route") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–†–æ–∑—Å–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Ç–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞!');
                    location.reload();
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + error);
            });
        }
        
        function toggleUserFilterFields() {
            const userFilter = document.getElementById('user_filter').value;
            const statusFilterGroup = document.getElementById('status_filter_group');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≥—Ä—É–ø–ø—ã
            statusFilterGroup.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≥—Ä—É–ø–ø—É
            if (userFilter === 'status') {
                statusFilterGroup.style.display = 'block';
            }
        }
        

        
        function toggleRecurringFields() {
            const isRecurring = document.getElementById('is_recurring').checked;
            const recurringFields = document.getElementById('recurring_fields');
            const recurringDays = document.getElementById('recurring_days');
            const recurringTime = document.getElementById('recurring_time');
            
            if (isRecurring) {
                recurringFields.style.display = 'block';
                recurringDays.setAttribute('required', 'required');
                recurringTime.setAttribute('required', 'required');
            } else {
                recurringFields.style.display = 'none';
                recurringDays.removeAttribute('required');
                recurringTime.removeAttribute('required');
            }
        }
        
        function resendMailing(id, mailingName) {
            if (confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É "${mailingName}" –∑–Ω–æ–≤—É?`)) {
                window.location.href = `/resend_mailing/${id}`;
            }
        }
        
        function makeRecurring(id, mailingName) {
            // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ—ó —Ä–æ–∑—Å–∏–ª–∫–∏
            const days = prompt('–í–≤–µ–¥–∏—Ç–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (0-–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 1-–≤—Ç–æ—Ä–Ω–∏–∫, —Ç–æ—â–æ):\n–ù–∞–ø—Ä–∏–º–µ—Ä: 0,4 –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –∏ –ø—è—Ç–Ω–∏—Ü—ã');
            if (days === null) return;
            
            const time = prompt('–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM (–Ω–∞–ø—Ä–∏–º–µ—Ä, 09:00):');
            if (time === null) return;
            
            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
            if (!days.trim() || !time.trim()) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥–Ω—ñ —Ç–∞ —á–∞—Å!');
                return;
            }
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç
            const formData = new FormData();
            formData.append('is_recurring', 'true');
            formData.append('recurring_days', days.trim());
            formData.append('recurring_time', time.trim());
            
            fetch(`/toggle_recurring_mailing/${id}`, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ—ó —Ä–æ–∑—Å–∏–ª–∫–∏!');
                }
            })
            .catch(error => {
                alert('–ü–æ–º–∏–ª–∫–∞: ' + error);
            });
        }
        
        function toggleRecurring(id, mailingName, isActive) {
            const action = isActive ? '–≤–∏–º–∫–Ω—É—Ç–∏' : '—É–≤—ñ–º–∫–Ω—É—Ç–∏';
            if (confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ ${action} –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è —Ä–æ–∑—Å–∏–ª–∫–∏ "${mailingName}"?`)) {
                const formData = new FormData();
                formData.append('is_recurring', (!isActive).toString());
                
                fetch(`/toggle_recurring_mailing/${id}`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ—ó —Ä–æ–∑—Å–∏–ª–∫–∏!');
                    }
                })
                .catch(error => {
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + error);
                });
            }
        }
        
        function showTab(tabName) {
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –∑ —É—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—É –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // –ê–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');
        }
        
        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –º–∞—Å–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
        function resendAllSent() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ —Ä–æ–∑—Å–∏–ª–∫–∏ –∑–Ω–æ–≤—É?')) {
                const sentMailings = document.querySelectorAll('#tab-sent .mailing-card, #tab-all .mailing-card');
                let count = 0;
                
                sentMailings.forEach(card => {
                    const resendBtn = card.querySelector('.resend-btn');
                    if (resendBtn) {
                        count++;
                    }
                });
                
                if (count > 0) {
                    showLoading(`–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ ${count} —Ä–æ–∑—Å–∏–ª–æ–∫ –∑–Ω–æ–≤—É...`);
                    
                    // –°–∏–º—É–ª—é—î–º–æ –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                    setTimeout(() => {
                        hideLoading();
                        alert(`‚úÖ –£—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ ${count} —Ä–æ–∑—Å–∏–ª–æ–∫ –∑–Ω–æ–≤—É!`);
                        location.reload();
                    }, 2000);
                } else {
                    alert('–ù–µ–º–∞—î –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏—Ö —Ä–æ–∑—Å–∏–ª–æ–∫ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏.');
                }
            }
        }
        
        function showLoading(message) {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-overlay';
            loadingDiv.innerHTML = `
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p>${message}</p>
                </div>
            `;
            document.body.appendChild(loadingDiv);
        }
        
        function hideLoading() {
            const loadingDiv = document.getElementById('loading-overlay');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }
        
        function makeAllRecurring() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –≤—Å—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ —Ä–æ–∑—Å–∏–ª–∫–∏ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∏–º–∏?')) {
                const sentMailings = document.querySelectorAll('#tab-sent .mailing-card, #tab-all .mailing-card');
                let count = 0;
                
                sentMailings.forEach(card => {
                    const makeRecurringBtn = card.querySelector('.make-recurring-btn');
                    if (makeRecurringBtn) {
                        count++;
                    }
                });
                
                if (count > 0) {
                    alert(`–ë—É–¥–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ ${count} —Ä–æ–∑—Å–∏–ª–æ–∫ —è–∫ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –∫–æ–∂–Ω–æ—ó.`);
                } else {
                    alert('–ù–µ–º–∞—î –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏—Ö —Ä–æ–∑—Å–∏–ª–æ–∫ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–Ω—è.');
                }
            }
        }
        
        function sendAllScheduled() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–µ–π—á–∞—Å?')) {
                const scheduledMailings = document.querySelectorAll('#tab-scheduled .mailing-card');
                let count = scheduledMailings.length;
                
                if (count > 0) {
                    alert(`–ë—É–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${count} –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ —Å–µ–π—á–∞—Å.`);
                    // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–ª—è –º–∞—Å–æ–≤–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                } else {
                    alert('–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.');
                }
            }
        }
        
        function cancelAllScheduled() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—Å—ã–ª–æ–∫?')) {
                const scheduledMailings = document.querySelectorAll('#tab-scheduled .mailing-card');
                let count = scheduledMailings.length;
                
                if (count > 0) {
                    alert(`–ë—É–¥–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ${count} —Ä–∞—Å—Å—ã–ª–æ–∫.`);
                    // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–ª—è –º–∞—Å–æ–≤–æ–≥–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
                } else {
                    alert('–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–º–µ–Ω—ã.');
                }
            }
        }
        
        function resendAllRecurring() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–Ω–æ–≤–∞?')) {
                const recurringMailings = document.querySelectorAll('#tab-recurring .mailing-card');
                let count = recurringMailings.length;
                
                if (count > 0) {
                    alert(`–ë—É–¥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${count} –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—Å—ã–ª–æ–∫ —Å–Ω–æ–≤–∞.`);
                    // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–ª—è –º–∞—Å–æ–≤–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                } else {
                    alert('–ù–µ–º–∞—î –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.');
                }
            }
        }
        
        function disableAllRecurring() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—Å—ã–ª–æ–∫?')) {
                const recurringMailings = document.querySelectorAll('#tab-recurring .mailing-card');
                let count = recurringMailings.length;
                
                if (count > 0) {
                    alert(`–ë—É–¥–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ${count} —Ä–∞—Å—Å—ã–ª–æ–∫.`);
                    // –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–ª—è –º–∞—Å–æ–≤–æ–≥–æ –≤–∏–º–∫–Ω–µ–Ω–Ω—è
                } else {
                    alert('–ù–µ–º–∞—î –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ä–∞—Å—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è.');
                }
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ä–æ–∑—Å–∏–ª–æ–∫
        function filterMailings(tabName) {
            const searchInput = document.getElementById(`search-${tabName}`);
            const filterSelect = document.getElementById(`filter-${tabName}`);
            const mailingCards = document.querySelectorAll(`#tab-${tabName} .mailing-card`);
            
            const searchTerm = searchInput.value.toLowerCase();
            const filterValue = filterSelect ? filterSelect.value : '';
            
            mailingCards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const text = card.querySelector('p').textContent.toLowerCase();
                const status = card.querySelector('.status-active, .status-scheduled, .status-inactive');
                const statusText = status ? status.textContent.toLowerCase() : '';
                
                let showCard = true;
                
                // –ü–æ—à—É–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
                if (searchTerm && !title.includes(searchTerm) && !text.includes(searchTerm)) {
                    showCard = false;
                }
                
                // –§—ñ–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
                if (filterValue) {
                    if (filterValue === 'sent' && !statusText.includes('–Ω–∞–¥—ñ—Å–ª–∞–Ω–∞')) {
                        showCard = false;
                    } else if (filterValue === 'scheduled' && !statusText.includes('–∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞')) {
                        showCard = false;
                    } else if (filterValue === 'draft' && !statusText.includes('—Å—Ç–≤–æ—Ä–µ–Ω–∞')) {
                        showCard = false;
                    } else if (filterValue === 'recurring') {
                        const recurringIndicator = card.querySelector('p strong:contains("üîÑ –ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–∞")');
                        if (!recurringIndicator) {
                            showCard = false;
                        }
                    }
                }
                
                card.style.display = showCard ? 'block' : 'none';
            });
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏
            updateTabCounts();
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ –≤–∫–ª–∞–¥–æ–∫
        function updateTabCounts() {
            const tabs = ['all', 'sent', 'scheduled', 'recurring'];
            
            tabs.forEach(tab => {
                const visibleCards = document.querySelectorAll(`#tab-${tab} .mailing-card[style*="block"], #tab-${tab} .mailing-card:not([style*="none"])`);
                const countElement = document.querySelector(`button[onclick="showTab('${tab}')"] .tab-count`);
                
                if (countElement) {
                    countElement.textContent = `(${visibleCards.length})`;
                }
            });
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä–æ–∑—Å–∏–ª–æ–∫ —É –∫–æ–∂–Ω—ñ–π –≤–∫–ª–∞–¥—Ü—ñ
        function countMailingsByType() {
            // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ —Ä–æ–∑—Å–∏–ª–∫–∏
            const sentCount = document.querySelectorAll('#tab-sent .mailing-card').length;
            document.getElementById('sent-count').textContent = `(${sentCount})`;
            
            // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ —Ä–æ–∑—Å–∏–ª–∫–∏
            const scheduledCount = document.querySelectorAll('#tab-scheduled .mailing-card').length;
            document.getElementById('scheduled-count').textContent = `(${scheduledCount})`;
            
            // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ —Ä–æ–∑—Å–∏–ª–∫–∏
            const recurringCount = document.querySelectorAll('#tab-recurring .mailing-card').length;
            document.getElementById('recurring-count').textContent = `(${recurringCount})`;
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            toggleMediaFields();
            toggleUserFilterFields(); // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Ñ—ñ–ª—å—Ç—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            
            // –õ–æ–≥—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
            console.log('üîç DEBUG: –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞');
            const container = document.getElementById('buttons-container');
            console.log('   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫:', container);
            console.log('   –ü–æ—á–∞—Ç–∫–æ–≤–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–æ–ø–æ–∫:', container.querySelectorAll('input[name="button_text[]"]').length);
            
            // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–æ–∑—Å–∏–ª–æ–∫ —É –∫–æ–∂–Ω—ñ–π –≤–∫–ª–∞–¥—Ü—ñ
            countMailingsByType();
            
            // Event listeners for start buttons
            document.querySelectorAll('.start-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    startMailing(id);
                });
            });
            
            // Event listeners for delete buttons
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    
                    deleteMailing(id, name);
                });
            });
            
            // Event listeners for cancel schedule buttons
            document.querySelectorAll('.cancel-schedule-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    
                    cancelScheduledMailing(id, name);
                });
            });
            
            // Event listeners for resend buttons
            document.querySelectorAll('.resend-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    
                    resendMailing(id, name);
                });
            });
            
            // Event listeners for make recurring buttons
            document.querySelectorAll('.make-recurring-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    
                    makeRecurring(id, name);
                });
            });
            
            // Event listeners for toggle recurring buttons
            document.querySelectorAll('.toggle-recurring-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    const isActive = this.dataset.active === 'true';
                    
                    toggleRecurring(id, name, isActive);
                });
            });
        });
    </script>
</body>
</html>